{% comment %}
RaffleBee Cart Banner - Shows sweepstakes threshold progress
{% endcomment %}

{% if cart.total_price > 0 %}
  <div id="raffle-banner" style="display: none; padding: 15px; margin: 10px 0; border-radius: 5px; text-align: center; font-weight: bold; color: white; background-color: {{ block.settings.banner_color | default: '#1976d2' }};">
    <div id="raffle-banner-content">
      <!-- Content will be populated by JavaScript -->
    </div>
  </div>

  <script>
    (function() {
      const banner = document.getElementById('raffle-banner');
      const content = document.getElementById('raffle-banner-content');
      
      // Get cart total (convert from cents to dollars)
      const cartTotal = {{ cart.total_price | divided_by: 100.0 }};
      
      // Fetch merchant threshold and prize pool
      fetch('/apps/rafflebee/api/cart-check', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          cartTotal: cartTotal,
          shop: Shopify.shop
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.showBanner) {
          if (data.qualified) {
            content.innerHTML = `ðŸŽ‰ You qualify for a chance to win ${data.prizeAmount}!`;
            banner.style.backgroundColor = '#4caf50'; // Green for qualified
          } else {
            const remaining = (data.threshold - cartTotal).toFixed(2);
            content.innerHTML = `Add $${remaining} more for a chance to win ${data.prizeAmount}!`;
          }
          banner.style.display = 'block';
        }
      })
      .catch(error => {
        console.error('RaffleBee banner error:', error);
      });
    })();
  </script>
{% endif %}